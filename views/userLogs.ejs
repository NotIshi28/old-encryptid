<body>
    <div id="screen">
        <div id="content">
            <%- include('partials/nav.ejs') %>
            <div class="windowsGrp">
                <div class="start">
                    <div class="start-menu" id="start-menu" style="display:none; position: absolute; bottom: 15%; left: -0.5vw; width: 20vw; background-color: #C0C0C0; border: 2px solid #000; z-index: 1000; box-shadow: 5px 5px 15px rgba(0,0,0,0.5);">
                        <div class="start-menu-header" style="background-color: #000080; color: #fff; padding: 0.5vw; font-size: 1vw; display: flex; align-items: center;">
                            <img src="https://avatars.githubusercontent.com/u/50449253?s=200&v=4" alt="Windows Logo" style="margin-right: 0.5vw; width: 2vw;">
                            Syndicate '95
                        </div>
                        <% if (user) { %>
                            <div class="start-menu-item" style="padding: 0.5vw; font-size: 1vw; cursor: pointer; display: flex; align-items: center;">
                                <img src="https://avatars.githubusercontent.com/u/50449253?s=200&v=4" alt="My Computer" style="margin-right: 0.5vw; width: 2vw;">
                                My Computer
                            </div>
                            <div class="start-menu-item" style="padding: 0.5vw; font-size: 1vw; cursor: pointer; display: flex; align-items: center;">
                                <img src="https://avatars.githubusercontent.com/u/50449253?s=200&v=4" alt="Recycle Bin" style="margin-right: 0.5vw; width: 2vw;">
                                Recycle Bin
                            </div>
                            <div class="start-menu-item" style="padding: 0.5vw; font-size: 1vw; cursor: pointer; display: flex; align-items: center;">
                                <img src="https://avatars.githubusercontent.com/u/50449253?s=200&v=4" alt="Control Panel" style="margin-right: 0.5vw; width: 2vw;">
                                Control Panel
                            </div>
                            <div class="start-menu-item" style="padding: 0.5vw; font-size: 1vw; cursor: pointer; display: flex; align-items: center;">
                                <img src="https://avatars.githubusercontent.com/u/50449253?s=200&v=4" alt="Run" style="margin-right: 0.5vw; width: 2vw;">
                                Run
                            </div>
                            <a href="#" onclick="powerOff()" style="text-decoration: none; color:#009900">
                                <div class="start-menu-item" style="padding: 0.5vw; font-size: 1vw; cursor: pointer; display: flex; align-items: center;">
                                    <img src="https://avatars.githubusercontent.com/u/50449253?s=200&v=4" alt="Shutdown" style="margin-right: 0.5vw; width: 2vw;">
                                    Shutdown
                                </div>
                            </a>
                            <% } else{ %>                        
                                <a href="/login" style="text-decoration: none; color:#009900">
                                    <div class="start-menu-item" style="padding: 0.5vw; font-size: 1vw; cursor: pointer; display: flex; align-items: center;">
                                        <img src="https://avatars.githubusercontent.com/u/50449253?s=200&v=4" alt="Shutdown" style="margin-right: 0.5vw; width: 2vw;">
                                        Get Started
                                    </div>
                                </a>
                                <a href="/leaderboard" style="text-decoration: none; color:#009900">
                                    <div class="start-menu-item" style="padding: 0.5vw; font-size: 1vw; cursor: pointer; display: flex; align-items: center;">
                                        <img src="https://avatars.githubusercontent.com/u/50449253?s=200&v=4" alt="Shutdown" style="margin-right: 0.5vw; width: 2vw;">
                                        View leaderboard
                                    </div>
                                </a>
                        <% } %>
                    </div>
                </div>
                <div id="colorControls" class="windows" style="display: none; top: 200px; left: 200px; width: 50vw; height: 20vh; position: absolute; z-index: 1000; border: 2px solid #000; background-color: #C0C0C0; box-shadow: 5px 5px 15px rgba(0,0,0,0.5); overflow-y: hidden;">
                    <div class="window-header" style="background-color: #000080; color: #fff; padding: 0.5vw; font-size: 1vw; display: flex; justify-content: space-between; align-items: center; cursor: move;">
                        <span>Color Controls</span>
                        <button onclick="showWin('colorControls','none');return false;" style="background-color: #ff0000; padding: 0.7vw; color: #fff; border: none; cursor: pointer;">X</button>
                    </div>
                    <div class="window-content" style="padding: 1vw; background-color: #707070; height: calc(100% - 2vw); overflow-y: auto; font-size: 1vw;">
                        <table cellspacing="0" cellpadding="4" border="1" width="100%" class="tableList" style="color: #fff;">
                            <tr>
                                <td align="center" class="manos tdWindow"><a border="0" onclick="setColor('colA','svg-root','originalC')" style="color: #fff;">Original</a></td>
                                <td align="center" class="manos tdWindow"><a border="0" onclick="setColor('colA','svg-root','blueC')" style="color: #fff;">Blue</a></td>
                                <td align="center" class="manos tdWindow"><a border="0" onclick="setColor('colA','svg-root','greenC')" style="color: #fff;">Green</a></td>
                            </tr>
                            <tr>
                                <td align="center" class="manos tdWindow"><a border="0" onclick="setColor('colA','svg-root','redC')" style="color: #fff;">Red</a></td>
                                <td align="center" class="manos tdWindow"><a border="0" onclick="setColor('colA','svg-root','yellowC')" style="color: #fff;">Yellow</a></td>
                                <td align="center" class="manos tdWindow"><a border="0" onclick="setColor('colA','svg-root','grayC')" style="color: #fff;">Gray</a></td>
                            </tr>
                        </table>
                        <center>
                            <span class="textbutton" onclick="showWin('colorControls','none');return false;" style="color: #fff;">
                                <br>[ OK ]<br><br><br>
                            </span>
                        </center>
                    </div>
                </div>

                <div id="settingsPanel" class="settingsPanel windows" style="display: none; top: 200px; left: 200px; width: 20vw; height: 20vh; position: absolute; z-index: 1000; border: 2px solid #000; background-color: #C0C0C0; box-shadow: 5px 5px 15px rgba(0,0,0,0.5);">
                    <div class="window-header" style="background-color: #000080; color: #fff; padding: 0.5vw; font-size: 1vw; display: flex; justify-content: space-between; align-items: center; cursor: move;">
                        <span>Settings</span>
                        <button onclick="showWin('settingsPanel','none');return false;" style="background-color: #ff0000; padding: 0.7vw; color: #fff; border: none; cursor: pointer;">X</button>
                    </div>
                    <div class="window-content" style="padding: 1vw; background-color: #707070; height: calc(100% - 2vw); overflow-y: auto; font-size: 1vw;">
                        <a onclick="showWin('colorControls','block');showWin('settingsPanel','none');return false;" style="display: block; color: #fff; padding: 0.7vw; cursor: pointer;">Color Control</a>
                        <a onclick="showWin('wallpaper','block');showWin('settingsPanel','none');return false;" style="display: block; color: #fff; padding: 0.7vw; cursor: pointer;">Change Wallpaper</a>
                    </div>
                </div>

                <div id="wallpaper" class="windows" style="display: none; top: 200px; left: 200px; width: 30vw; height: 30vh; position: absolute; z-index: 1000; border: 2px solid #000; background-color: #C0C0C0; box-shadow: 5px 5px 15px rgba(0,0,0,0.5);">
                    <div class="window-header" style="background-color: #000080; color: #fff; padding: 0.5vw; font-size: 1vw; display: flex; justify-content: space-between; align-items: center; cursor: move;">
                        <span>Change Wallpaper</span>
                        <button onclick="showWin('wallpaper','none');return false;" style="background-color: #ff0000; padding: 0.7vw; color: #fff; border: none; cursor: pointer;">X</button>
                    </div>
                    <div class="window-content" style="padding: 1vw; background-color: #707070; height: calc(100% - 2vw); overflow-y: auto; font-size: 1vw;">
                        <form id="wallpaperForm" onsubmit="changeWallpaper(event)">
                            <label for="wallpaperFile" style="color: #fff;">Upload File:</label>
                            <input type="file" id="wallpaperFile" name="wallpaperFile" accept="image/*" style="margin-bottom: 1vw;">
                            <br>
                            <label for="wallpaperUrl" style="color: #fff;">Or Enter Image URL:</label>
                            <input type="text" id="wallpaperUrl" name="wallpaperUrl" placeholder="http://example.com/image.jpg" style="width: 100%; margin-bottom: 1vw;">
                            <br>
                            <button type="submit" style="background-color: #000080; color: #fff; padding: 0.5vw; border: none; cursor: pointer;">Set Wallpaper</button>
                        </form>
                    </div>
                </div>	
                
                <div id="pcWindow" class="windows" style="display: block; top: 10%; left: 6%; width: 80%; height: 70%; position: absolute; overflow-y: scroll; background-color: #6f6f6f;">
                    <div class="window-header" style="background-color: #000080; color: #fff; padding: 0.2vw; font-size: 1vw; display: flex; justify-content: space-between; align-items: center; ">
                        <div class="head" style="cursor: move; width: 95%; padding-top: 0.5vw; padding-bottom: 0.5vw;">
                            <span>This PC</span>
                        </div>
                        <div class="x">
                            <button onclick="closeWindow()" style="background-color: #ff0000; padding:1vw; color: #fff; border: none; cursor: pointer; z-index: 15000;">X</button>
                        </div>
                    </div>
                    <div class="window-content" style="padding: 1vw; background-color: #707070; height: calc(100% - 2vw);">
                        <div style="font-size: 1vw; color: #fff; padding: 0.5vw; background-color: #505050;">
                            C:\Encryptid\Admin\<%= user.username %>\Logs\<%= user.username %>
                        </div>       
                        
                        <h1>User Logs</h1>
                        <a href="/admin/ban/<%= user._id %>" style="text-decoration: none; color: #000;">ban <%= user.username %></a>
                        <h2>Cryptic Logs</h2>
                        <table border="1" style="color: #fff;">
                            <tr>
                                <th>Level</th>
                                <th>Answer</th>
                                <th>Timestamp</th>
                                <th>Correct</th>
                            </tr>
                            <% crypticLogs.forEach(log => { %>
                                <tr>
                                    <td><%= log.level %></td>
                                    <td><%= log.answer %></td>
                                    <td><%= log.timestamp %></td>
                                    <td><%= log.isCorrect %></td>
                                </tr>
                            <% }) %>
                        </table>
                    
                        <h2>CTF Logs</h2>
                        <table border="1" style="color: #fff;">
                            <tr>
                                <th>Level</th>
                                <th>Answer</th>
                                <th>Timestamp</th>
                                <th>Correct</th>
                            </tr>
                            <% ctfLogs.forEach(log => { %>
                                <tr>
                                    <td><%= log.level %></td>
                                    <td><%= log.answer %></td>
                                    <td><%= log.timestamp %></td>
                                    <td><%= log.isCorrect %></td>
                                </tr>
                            <% }) %>
                        </table>
                    
                        <h2>Correct Cryptic Logs</h2>
                        <table border="1" style="color: #fff;">
                            <tr>
                                <th>Level</th>
                                <th>Answer</th>
                                <th>Timestamp</th>
                            </tr>
                            <% crypticLogs.forEach(log => { %>
                                <% if (log.isCorrect) { %>
                                    <tr>
                                        <td><%= log.level %></td>
                                        <td><%= log.answer %></td>
                                        <td><%= log.timestamp %></td>
                                    </tr>
                                <% } %>
                            <% }) %>
                        </table>
                    
                        <h2>Correct CTF Logs</h2>
                        <table border="1" style="color: #fff;">
                            <tr>
                                <th>Level</th>
                                <th>Answer</th>
                                <th>Timestamp</th>
                            </tr>
                            
                            <% ctfLogs.forEach(log => { %>
                                <% if (log.isCorrect) { %>
                                    <tr>
                                        <td><%= log.level %></td>
                                        <td><%= log.answer %></td>
                                        <td><%= log.timestamp %></td>
                                    </tr>
                                <% } %>
                            <% }) %>
                        </table>

                     </div>   
                </div>

            </div>
        </div>
    </div>
    <script>
        function closeWindow() {
            document.getElementById('pcWindow').style.display = 'none';
        }

        function makeWindowDraggable(windowId) {
            const windowElement = document.getElementById(windowId);
            const header = windowElement.querySelector('.window-header');
            let offsetX = 0, offsetY = 0, isDragging = false;

            header.addEventListener('mousedown', (e) => {
                isDragging = true;
                offsetX = e.clientX - windowElement.offsetLeft;
                offsetY = e.clientY - windowElement.offsetTop;
            });

            document.addEventListener('mousemove', (e) => {
                if (isDragging) {
                    windowElement.style.left = `${e.clientX - offsetX}px`;
                    windowElement.style.top = `${e.clientY - offsetY}px`;
                }
            });

            document.addEventListener('mouseup', () => {
                isDragging = false;
            });
        }

        function changeWallpaper(event) {
            event.preventDefault();
            const fileInput = document.getElementById('wallpaperFile');
            const urlInput = document.getElementById('wallpaperUrl');
            const screen = document.getElementById('screen');
            let wallpaperUrl = '';

            if (fileInput.files && fileInput.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    wallpaperUrl = e.target.result;
                    screen.style.backgroundImage = `url(${wallpaperUrl})`;
                    localStorage.setItem('wallpaper', wallpaperUrl);
                };
                reader.readAsDataURL(fileInput.files[0]);
            } else if (urlInput.value) {
                wallpaperUrl = urlInput.value;
                screen.style.backgroundImage = `url(${wallpaperUrl})`;
                localStorage.setItem('wallpaper', wallpaperUrl);
            }

            showWin('wallpaper', 'none');
        }
        makeWindowDraggable('pcWindow');
        makeWindowDraggable('settingsPanel');
        makeWindowDraggable('wallpaper');
        makeWindowDraggable('colorControls')
    </script>
</body>
